(function(c){"use strict";var d=function(e){if(this.settings={querySelector:"[data-method=\"mab-available-space-image\"]",onInit:null},"object"==typeof e)for(var f in e)e.hasOwnProperty(f)&&"undefined"!=typeof this.settings[f]&&(this.settings[f]=e[f]);this.devicePixelRatio=c.devicePixelRatio||1,this.imageSets=[],this.observer=null,this.imageCollection=document.querySelectorAll(this.settings.querySelector),this.init()};d.prototype={init:function(){var e=this,f=0;return this.imageCollection.forEach(function(g){if("img"===g.tagName.toLowerCase()){for(var h=[{width:320,src:g.getAttribute("src")}],j=0;j<g.attributes.length;j++)if(0===g.attributes[j].nodeName.indexOf("data-src-")){var l=parseInt(g.attributes[j].nodeName.replace("data-src-",""));l&&h.push({width:l,src:g.attributes[j].nodeValue})}h.sort(function(o,p){var q=0;return o.width>p.width?q=1:p.width>o.width&&(q=-1),q}),g.setAttribute("data-src-num",f),e.imageSets[f]={sourceSet:h,image:g,loadingImage:null},f++}}),"function"==typeof this.settings.onInit&&this.settings.onInit(this),c.IntersectionObserver?void(this.observer=new IntersectionObserver(function(g){g.forEach(function(h){0<h.intersectionRatio&&e.loadImage(h.target)})},{root:null,rootMargin:"0px",threshold:[0]}),this.imageSets.forEach(function(g){e.observer.observe(g.image)})):void this.imageSets.forEach(function(g){e.loadImage(g.image)})},getBestImageSrc:function(e){for(var f=e.image.parentNode.clientWidth*this.devicePixelRatio,g=0;g<e.sourceSet.length;g++)if(f<e.sourceSet[g].width)return e.sourceSet[g].src;return e.sourceSet[e.sourceSet.length-1].src},loadImage:function(e){var f=parseInt(e.getAttribute("data-src-num")),g=this.imageSets[f],h=this.getBestImageSrc(g),j=this;h!==e.getAttribute("src")&&(g.loadingImage=new Image,g.loadingImage.setAttribute("src",h),g.loadingImage.setAttribute("data-src-num",f),g.loadingImage.addEventListener("load",function(l){var o=parseInt(l.target.getAttribute("data-src-num"));j.imageSets[o]&&j.imageSets[o].image.setAttribute("src",l.target.getAttribute("src"))}))}},"function"==typeof define&&define.amd?define(function(){return d}):c.AvailableSpaceImages=d})(window);
