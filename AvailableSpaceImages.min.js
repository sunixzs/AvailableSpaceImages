(function(c){"use strict";var d=function(f){if(this.settings={querySelector:"[data-method=\"mab-available-space-image\"]",onInit:null},"object"==typeof f)for(var g in f)f.hasOwnProperty(g)&&"undefined"!=typeof this.settings[g]&&(this.settings[g]=f[g]);this.devicePixelRatio=c.devicePixelRatio||1,this.imageSets=[],this.observer=null,this.imageCollection=document.querySelectorAll(this.settings.querySelector),this.init()};d.prototype={isExplorer:function(){return document.documentMode||/Edge/.test(navigator.userAgent)},isInIframe:function(){try{return c.self!==c.top}catch(f){return!0}},init:function(){for(var j,f=this,g=0,h=0;h<this.imageCollection.length;h++){if(j=this.imageCollection[h],"img"!==j.tagName.toLowerCase())return;for(var p,l=[{width:320,src:j.getAttribute("src")}],o=0;o<j.attributes.length;o++)if(p=j.attributes[o],0===p.nodeName.indexOf("data-src-")){var q=parseInt(p.nodeName.replace("data-src-",""));q&&l.push({width:q,src:p.nodeValue})}l.sort(function(s,t){var u=0;return s.width>t.width?u=1:t.width>s.width&&(u=-1),u}),j.setAttribute("data-src-num",g),this.imageSets[g]={sourceSet:l,image:j,loadingImage:null},g++}if("function"==typeof this.settings.onInit&&this.settings.onInit(this),!c.IntersectionObserver||this.isExplorer()&&this.isInIframe()){for(var h=0;h<this.imageSets.length;h++)this.loadImage(this.imageSets[h].image);return}this.observer=new IntersectionObserver(function(s){for(var t=0;t<s.length;t++)0<s[t].intersectionRatio&&f.loadImage(s[t].target)},{root:null,rootMargin:"0px",threshold:[0]});for(var h=0;h<this.imageSets.length;h++)this.observer.observe(this.imageSets[h].image)},getBestImageSrc:function(f){for(var g=f.image.parentNode.clientWidth*this.devicePixelRatio,h=0;h<f.sourceSet.length;h++)if(g<f.sourceSet[h].width)return f.sourceSet[h].src;return f.sourceSet[f.sourceSet.length-1].src},loadImage:function(f){var g=parseInt(f.getAttribute("data-src-num")),h=this.imageSets[g],j=this.getBestImageSrc(h),l=this;j!==f.getAttribute("src")&&(h.loadingImage=new Image,h.loadingImage.setAttribute("src",j),h.loadingImage.setAttribute("data-src-num",g),h.loadingImage.addEventListener("load",function(o){var p=parseInt(o.target.getAttribute("data-src-num"));l.imageSets[p]&&l.imageSets[p].image.setAttribute("src",o.target.getAttribute("src"))}))}},"function"==typeof define&&define.amd?define(function(){return d}):c.AvailableSpaceImages=d})(window);
