!function(t){"use strict";var e=function(e){if(this.settings={querySelector:'[data-method="mab-available-space-image"]',onInit:null},"object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&void 0!==this.settings[i]&&(this.settings[i]=e[i]);this.devicePixelRatio=t.devicePixelRatio||1,this.imageSets=[],this.observer=null,this.imageCollection=document.querySelectorAll(this.settings.querySelector),this.init()};e.prototype={init:function(){var e=this,i=0;this.imageCollection.forEach(function(t){if("img"===t.tagName.toLowerCase()){for(var r=[{width:320,src:t.getAttribute("src")}],a=0;a<t.attributes.length;a++)if(0===t.attributes[a].nodeName.indexOf("data-src-")){var n=parseInt(t.attributes[a].nodeName.replace("data-src-",""));n&&r.push({width:n,src:t.attributes[a].nodeValue})}r.sort(function(t,e){var i=0;return t.width>e.width?i=1:e.width>t.width&&(i=-1),i}),t.setAttribute("data-src-num",i),e.imageSets[i]={sourceSet:r,image:t,loadingImage:null},i++}}),"function"==typeof this.settings.onInit&&this.settings.onInit(this),t.IntersectionObserver?(this.observer=new IntersectionObserver(function(t){t.forEach(function(t){t.intersectionRatio>0&&e.loadImage(t.target)})},{root:null,rootMargin:"0px",threshold:[0]}),this.imageSets.forEach(function(t){e.observer.observe(t.image)})):this.imageSets.forEach(function(t){e.loadImage(t.image)})},getBestImageSrc:function(t){for(var e=t.image.parentNode.clientWidth*this.devicePixelRatio,i=0;i<t.sourceSet.length;i++)if(e<t.sourceSet[i].width)return t.sourceSet[i].src;return t.sourceSet[t.sourceSet.length].src},loadImage:function(t){var e=parseInt(t.getAttribute("data-src-num")),i=this.imageSets[e],r=this.getBestImageSrc(i),a=this;r!==t.getAttribute("src")&&(i.loadingImage=new Image,i.loadingImage.setAttribute("src",r),i.loadingImage.setAttribute("data-src-num",e),i.loadingImage.addEventListener("load",function(t){var e=parseInt(t.target.getAttribute("data-src-num"));a.imageSets[e]&&a.imageSets[e].image.setAttribute("src",t.target.getAttribute("src"))}))}},"function"==typeof define&&define.amd?define(function(){return e}):t.AvailableSpaceImages=e}(window);